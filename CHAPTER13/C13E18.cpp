//CHAPTER 13 EX 18
//I believe the Polygon check is done intrinsically within Polygon::add(). No need to have another check inside the constructor?
#include "./sources.h"
#include <stdexcept>

struct Poly : Polygon
{
    Poly(initializer_list<Point> lst);
};

Poly::Poly(initializer_list<Point> lst)
{
    int np = list.size();

	if (1<np) {	// check that thenew line isn't parallel to the previous one
		if (p==point(np-1)) error("polygon point equal to previous point");
		bool parallel;
		line_intersect(point(np-1),p,point(np-2),point(np-1),parallel);
		if (parallel)
			error("two polygon points lie in a straight line");
	}

	for (int i = 1; i<np-1; ++i) {	// check that new segment doesn't interset and old point
		Point ignore(0,0);
		if (line_segment_intersect(point(np-1),p,point(i-1),point(i),ignore))
			error("intersect in polygon");
	}
    for (Point p : lst)
        Polygon::add(p);
}

int main()
try
{
    int win_x {1600};
    int win_y {900};
    Point tl {100,100};
    Simple_window win {tl,win_x,win_y,"Window"}; 

    

    win.wait_for_button();
}
catch(const std::exception& e)
{
    std::cerr << e.what() << '\n';
}
catch(...)
{
    // some more error reporting
    return 2;
}
